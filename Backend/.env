# ================= Security / Auth =================
SECRET_KEY=1b9f2cbe3a6f4d9a80c2c8e3d5f7a9c1e3f5a7b9c2d4e6f8a0b2c4d6e8f0a2b4
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_SECONDS=28800           # 8 ชม.
REFRESH_SECRET_KEY=1b9f2cbe3a6f4d9a80c2c8e3d5f7a9c1e3f5a7b9c2d4e6f8a0b2c4d6e8f0a2b4:refresh
REFRESH_TOKEN_EXPIRE_SECONDS=604800         # 7 วัน
JWT_CLOCK_SKEW_SECONDS=60

# ================= App / URLs =================
# FE/BE ฝั่ง dev ใช้ localhost ให้ตรงกัน
FRONTEND_BASE_URL=http://localhost:3000
PUBLIC_BASE_URL=http://localhost:8000

# backend ภายใน (ใช้เวลา backend เรียกตัวเองผ่าน internal API)
MAIN_BACKEND=http://127.0.0.1:8000
BACKEND_INTERNAL_BASE=http://127.0.0.1:8000

# WebSocket backend (ถ้ามี worker แยก)
WS_BACKEND_BASE=http://127.0.0.1:8011

# ================= Database =================
DB_PATH=./users.db
DATABASE_URL=sqlite:///./users.db
DEFAULT_PRINTER_ID=prusa-core-one
LEGACY_DB=1

# ================= Storage Backend =================
STORAGE_BACKEND=s3
DELETE_STAGING_AFTER_SLICE=0
PRESIGN_EXPIRES=600              # ลิงก์ presign มีอายุ 10 นาที

# ================= MinIO / S3 =================
# MinIO รันบนเครื่องตัวเอง
S3_ENDPOINT=http://localhost:9000
S3_PUBLIC_ENDPOINT=http://localhost:9000
S3_REGION=us-east-1
S3_BUCKET=printer-store
S3_FORCE_PATH_STYLE=true
S3_SECURE=false
S3_ACCESS_KEY=admin
S3_SECRET_KEY=admin123

# ================= CORS (React) =================
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# ================= PrusaSlicer (Windows) =================
PRUSA_SLICER_BIN=C:\Program Files\Prusa3D\PrusaSlicer\prusa-slicer-console.exe
PRUSA_DATADIR=C:\Users\apich\AppData\Roaming\PrusaSlicer
PRUSA_BUNDLE_PATH=C:\Users\apich\Documents\Wil Project\Wil_MR3DPrinter\WilProject_MR3DPrinter\Bundle\ADI_CleanPreview_bundle.ini

PRUSA_PRINTER_PRESET=Prusa CORE One HF0.4 nozzle - Copy
PRUSA_PRINT_PRESET=0.20mm SPEED @COREONE HF0.4 - Copy
PRUSA_ALLOW_FE_PRESET=1
PRUSA_STRICT_PRESET=1

FILAMENT_PROFILE_PLA=Generic PLA @COREONE HF0.4 - Copy
FILAMENT_PROFILE_PETG=Generic PETG @COREONE HF0.4 - Copy

PRUSA_ENABLE_THUMBNAIL=0
PRUSA_DEBUG_CLI=1

# ================= Slicer Preview / Manifest =================
AUTO_PREVIEW_ON_FINALIZE=1
AUTO_MANIFEST_ON_FINALIZE=1
AUTO_PREVIEW_ON_ENQUEUE=1

SLICER_PREVIEW_SIZE=1600x1200
SLICER_PREVIEW_AZ=45
SLICER_PREVIEW_EL=35.2643897

MIN_OK_PREVIEW_BYTES=4096
PREVIEW_DEBOUNCE_SEC=300

# ================= Teams DM via Power Automate =================
FLOW_DM_URL=https://2204a74cba9bee91bb1d4048872919.1b.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/3b99b4da6bbb4c7bb2219d790125417f/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=3AOFT8jdTe3BDFT-Mwq-8C2kKORQCRYy1znFvgdC5vY
FLOW_DM_TOKEN=supersecret123
FLOW_DM_TIMEOUT=8.0
FLOW_DM_SEND_AUTH_HEADER=0

DM_ENABLED=true
DM_FOR_TYPES=print.queued,print.started,print.processing,print.completed,print.failed,print.canceled,print.paused,print.issue
DM_REQUIRE_JOB_ID=true
DM_REQUIRE_PRINTER_ID=true
DM_SUPPRESS_TTL_SEC=20

DM_TITLE=ADI 3D Printer Console

# ================= Email (ตอนนี้ปิดไว้) =================
SMTP_ENABLED=false
SMTP_HOST=smtp.office365.com
SMTP_PORT=587
SMTP_TLS=true
SMTP_SSL=false
SMTP_USER=your_account@yourdomain.com
SMTP_PASS=********
EMAIL_FROM=your_account@yourdomain.com
EMAIL_FROM_NAME=3D Printer Bot

# ================= Camera / Snapshot =================
# กล้องจาก RasPi / mjpeg-streamer
SNAPSHOT_URL=http://10.228.0.239:8000/snapshot.jpg
REACT_APP_SNAPSHOT_FPS=10

# ถ้าอยากมีรูป fallback เวลากล้องล่ม (optional)
# FALLBACK_SNAPSHOT_FILE=./static/fixcamera.png
# FALLBACK_SNAPSHOT_URL=http://localhost:8000/static/fixcamera.png

# ================= Admin Token (ทุก internal call ต้องตรงกัน) =================
ADMIN_TOKEN=dev123

# ================= OctoPrint (Prusa Core One / Visual Printer) =================
OCTOPRINT_BASE=http://10.228.0.239:5000
OCTOPRINT_API_KEY=A3gQ6GXqJiKCzda9CLUjDY59hWGdVzdBqfpQynKUOm0

OCTOPRINT_TIMEOUT=15
OCTOPRINT_HTTP_TIMEOUT=30
OCTOPRINT_WRITE_TIMEOUT=180
OCTOPRINT_MIN_INTERVAL=2.0
OCTOPRINT_502_COOLDOWN=60.0

# ================= Detect / AI Alert Policy =================
# คลาสที่ detector ส่งมาแล้วยอมรับ
ALLOWED_DETECT_CLASSES=cracks,layer_shift,spaghetti,stringing

# min conf สำหรับ "นับว่าเป็น hit" ครั้งเดียว
MIN_DETECT_CONFIDENCE=0.60

# ให้เกิด alert ตอน issue_update ด้วยหรือไม่ (ส่งแต่อย่างเดียว, ไม่ pause ถ้าไม่เข้าเงื่อนไข)
ALERT_ON_UPDATE=1

ALERT_DEFAULT_EMPLOYEES=admin,qa_lead,shift_manager

# ---- Auto-pause จาก detector ----
AUTO_PAUSE_ON_DETECT=1

# *** สำคัญ: ไม่ pause ตอน issue_cleared แล้ว ***
PAUSE_ON_EVENTS=issue_started,issue_update

PAUSE_ON_CLASSES=cracks,layer_shift,spaghetti,stringing
PAUSE_MIN_CONFIDENCE=0.60

# ---- Debounce / Confirm anomaly ----
# บังคับให้ต้องมี hit สะสมในช่วงเวลา ก่อน confirm ว่ามี issue จริง
DETECT_CONFIRM_ENABLED=1
DETECT_CONFIRM_WINDOW_SEC=5.0
DETECT_CONFIRM_MIN_HITS=1
DETECT_CONFIRM_MIN_MEAN_CONF=0.65

# ================= Bed Empty / Auto-chain =================
BED_EMPTY_ALIASES=bed empty,bed_empty
BED_EMPTY_REQUIRE_RECENT_COMPLETION=0
BED_EMPTY_COMPLETION_WINDOW_SEC=0

# จะ process-next ได้ต้องเห็น bed_empty ภายในเวลาที่กำหนด
REQUIRE_BED_EMPTY_FOR_PROCESS_NEXT=1
BED_EMPTY_MAX_AGE_SEC=10

AUTO_START_ON_ENQUEUE=1
PRINT_AUTOSTART=1 

AUTO_CHAIN_ON_PRINTDONE=0
AUTO_CHAIN_ON_READY_PROGRESS=0
AUTO_CHAIN_DAEMON=1
AUTO_CHAIN_INTERVAL=5

# broadcast bed_empty ไป HoloLens/web หรือเปล่า (ตอนนี้ปิดอยู่)
BED_EMPTY_BROADCAST=0

# ================= Safeguard / Auto-heal / Close Job =================
SAFEGUARD_CLOSE_MODE=strict       # strict = ปิดงานเฉพาะที่ active จริง
COMPLETE_GUARD_TTL=45
CANCEL_GUARD_TTL=120

AUTO_HEAL_ATTACH=1                # พยายามผูก OctoPrint job กลับเข้าคิวเสมอ

# หลัง cancel/suppress ไม่ให้ส่ง event ซ้ำ ๆ ชั่วคราว
SUPPRESS_AFTER_CANCEL_SEC=25
JOB_EVENT_DEDUP_TTL_SEC=15
ANNOUNCE_TTL_HOURS=12

# ================= Printer Online TTL =================
PRINTER_ONLINE_TTL=30

# ================= Print Queue Behavior =================
PRINT_AUTOSTART=1             # upload อย่างเดียว → ยังไม่พิมพ์อัตโนมัติ
AUTO_NOTIFY_ON_READY_PROGRESS=1    # แจ้งเตือนเมื่อสถานะเปลี่ยนเป็น ready+progress

# ================= HoloLens / UI Mirror =================
HOLOLENS_MIRROR_USER_NOTIFS=1
HOLOLENS_MIRROR_EVENT_NAME=toast

# ================= Misc =================
RECENT_DETECT_MAX=500
WATCH_BED_EMPTY_TIMEOUT_SEC=300
DM_ENABLED=true
EMAIL_ENABLED=false
