/* ========================
   Brand & tokens
======================== */
:root{
  --brand-primary: #0b5ecf;
  --brand-hover:   #004985;
  --brand-deep:    #00325C;
  --ui-bg: #f6f7f8;
  --ui-border: #e5e7eb;
  --ui-muted: #9aa0a6;
  --ui-text: #111;
}

/* ========================
   Overlay & Modal
======================== */
.modal-overlay{
  position: fixed; inset: 0;
  background: rgba(0,0,0,.55);
  z-index: 1000;
  display: flex; align-items: center; justify-content: center;
}

.modal{
  position: relative;
  background: #fff;
  width: min(560px, 92vw);
  max-height: 88vh;
  overflow: visible;                 /* ให้ปุ่มปิดล้นได้ */
  border-radius: 24px;
  padding: 24px 18px 18px;
  box-shadow: 0 18px 60px rgba(0,0,0,.32);
  scrollbar-width: thin;
  scrollbar-color: rgba(0,0,0,.28) transparent;
}

/* เนื้อหาด้านในเป็นคนสกรอลล์แทน */
.upload-box{
  text-align: center;
  max-height: calc(88vh - 64px);
  overflow: auto;
}

.modal::-webkit-scrollbar{ width: 10px; height: 0; }
.modal::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.28); border-radius: 8px; }
.modal::-webkit-scrollbar-track{ background: transparent; }

/* Close — ไอคอนลอย ไม่มีพื้นหลัง/กรอบ */
.close-btn{
  position: absolute;
  top: -36px;                        /* ลอยออกนอกกรอบมากขึ้น */
  right: -36px;
  width: 48px; height: 48px;         /* hit area ใหญ่ คลิกง่าย */
  display: grid; place-items: center;
  background: transparent;
  border: none;
  padding: 0;
  cursor: pointer;
  z-index: 1100;
}
.close-btn:hover   .close-icon{ transform: scale(1.08); filter: invert(1) drop-shadow(0 2px 6px rgba(0,0,0,.6)); }
.close-btn:active  .close-icon{ transform: scale(0.96); opacity: .92; }
.close-btn:focus-visible{ outline: 2px solid rgba(255,255,255,.75); outline-offset: 3px; border-radius: 999px; }

/* ไอคอนกากบาทใหญ่ ขาวคมชัด */
.close-icon{
  width: 28px; height: 28px; display: block;
  filter: invert(1) drop-shadow(0 1px 3px rgba(0,0,0,.6));
  transition: transform .12s ease, filter .12s ease, opacity .12s ease;
}

/* ป้องกันปุ่มชนขอบบนจอเล็ก */
@media (max-width: 480px){
  .close-btn{ top: -28px; right: -28px; width: 44px; height: 44px; }
  .close-icon{ width: 26px; height: 26px; }
}

/* ========================
   Upload area
======================== */
.upload-area{
  border: 3px dashed var(--brand-primary);
  background: #eaf3ff;
  border-radius: 20px;
  padding: 28px 16px 26px;
  margin: 12px 12px 0;
}
.upload-area.is-dragover{ background: #e1eeff; border-color: #0a6dff; }

.upload-icon{ width: 52px; height: 52px; object-fit: contain; margin-bottom: 12px; }
.upload-text strong{ font-size: 20px; }
.upload-text p{ color:#7a8090; margin-top:6px; font-size:14px; }

.browse-btn{
  margin-top: 14px;
  padding: 9px 16px;
  border: 2px solid var(--brand-primary);
  background: #fff; color: var(--brand-primary);
  font-weight: 700;
  border-radius: 999px; cursor: pointer;
}
.browse-btn:hover{ border-color: var(--brand-hover); color: var(--brand-hover); }
.file-input-hidden{ display: none; }

/* ========================
   Upload status card
======================== */
.upload-row{
  margin: 14px 12px 0;
  text-align: left;
  background: var(--ui-bg);
  border: 1px solid var(--ui-border);
  border-radius: 12px;
  padding: 10px 12px 12px;
  box-shadow: none;
}

/* เคลียร์พื้นหลัง/เงาในชั้นลูก (คงกรอบเทาไว้) */
.upload-row *, .upload-row *::before, .upload-row *::after{
  background: transparent;
  background-image: none;
  box-shadow: none;
  border: 0;
}
/* ไลบรารียอดนิยมที่มักใส่พื้นขาว */
.upload-row :is(.bg-white, .card, .Paper, .MuiPaper-root, .ant-card,
                .chakra-card, .mantine-Paper-root, .panel, .wrapper){
  background: transparent !important;
  box-shadow: none !important;
  border: 0 !important;
}

.row-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
.tag{ padding:0; border-radius:0; font-weight:800; font-size:12px; }
.tag.uploading{ color:#ff7a17; }
.tag.done{ color:var(--brand-primary); }
.tag.error{ color:#b91c1c; }

.row-clear{
  width: 28px; height: 28px;
  border: 1px solid var(--ui-border);
  background: var(--ui-bg);
  border-radius: 50%;
  display:grid; place-items:center;
  font-size: 18px; line-height: 1;
  color:#8b8b8b; cursor:pointer;
}
.row-clear:hover{ filter:brightness(.98); }

/* ชื่อไฟล์ยาวไม่โดนตัด */
.row-file{
  display:flex; align-items:flex-start; justify-content:space-between;
  gap:8px; margin:2px 0 6px; padding:6px 0;
}
.file-name{
  flex:1 1 auto; max-width:100%; font-weight:700; color:var(--ui-text);
  white-space: normal; overflow-wrap: anywhere; word-break: break-word;
}
.file-pct{ flex:0 0 auto; font-size:13px; color:#666; }

/* progress bar */
.progress-bar{ height:6px; background: var(--ui-border); border-radius:999px; overflow:hidden; }
.progress-fill{ height:100%; width:0%; background:#ff7a17; transition:width .2s ease; }
.err-msg{ margin-top:6px; color:#b00020; font-size:13px; }

/* ซ่อน progress เมื่ออัปโหลดเสร็จ */
.upload-row:has(.tag.done) .progress-bar{ display:none; }

/* ========================
   Form base
======================== */
.slice-form{ margin: 14px 12px 0; text-align: left; }
.form-row{ margin-bottom: 12px; }

.form-label{
  display: flex; align-items: baseline; gap: 6px;
  margin-bottom: 6px;
  font-weight: 800; color: var(--ui-text); font-size: 13px;
}
.form-label.-inline{ flex-wrap: wrap; row-gap: 4px; }
.label-main{ line-height: 1.2; }
.req{ color:#C81A28; margin-left: 2px; }
.form-label .help{ font-weight:600; font-size:12px; color:var(--ui-muted); }

/* Inputs */
.input,
.select,
input.input,
select.input,
textarea.input{
  box-sizing:border-box; width:100%; height:36px;
  border:1px solid var(--ui-border); border-radius:12px;
  padding:0 12px; background:var(--ui-bg);
  font-size:14px; color:var(--ui-text);
}
.input::placeholder{ color:#b2b8c2; }
.input:focus,
.select:focus{
  outline:none; border-color:var(--brand-hover);
  background:var(--ui-bg);
  box-shadow:0 0 0 2px rgba(0,73,133,.18);
}
.input.invalid{ border-color:#b00020; background:#fff5f5; }

/* Select */
.select{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background-color:#f3f4f6; padding-right:36px;
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><path d='M6 8l4 4 4-4' stroke='%2300325C' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' fill='none'/></svg>");
  background-repeat:no-repeat; background-position:right 10px center; background-size:16px 16px;
}
.select:hover{ border-color: var(--brand-deep); }
.select:focus{ border-color: var(--brand-deep); box-shadow: 0 0 0 2px rgba(0,50,92,.18); color:var(--ui-text); }
.select:not(:focus):invalid{ color:var(--ui-muted); }
.select:disabled{ color:var(--ui-muted); background-color:var(--ui-bg); opacity:1; }
.select option{ color:var(--ui-text); }
.select option[disabled]{ color:var(--ui-muted); }

/* Number: ซ่อน spinner */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }
input[type="number"]{ -moz-appearance:textfield; }

/* ========================
   2 ช่องบรรทัดเดียว (Infill + Walls)
======================== */
.controls-row.-two{
  display:flex; flex-wrap: nowrap; gap:20px; align-items:flex-start;
}
.controls-row.-two > .form-row{
  flex:1 1 auto; min-width:0; margin-bottom:0;
  display:grid; grid-template-rows:auto 36px auto;
}
.controls-row.-two > .form-row.walls-row{ flex:0 0 250px; min-width:240px; }
.controls-row.-two .input,
.controls-row.-two .select,
.controls-row.-two .stepper{ align-self:end; }
.controls-row.-two .assist{ margin-top:6px; }

/* ========================
   Stepper กลม
======================== */
.stepper{ display:flex; align-items:center; gap:8px; height:36px; }
.step-btn{
  width:36px; height:36px; border:1px solid var(--ui-border);
  border-radius:999px; background:var(--ui-bg);
  font-size:18px; font-weight:800; display:grid; place-items:center;
  line-height:1; cursor:pointer;
}
.step-btn[disabled]{ opacity:.5; cursor:not-allowed; }
.step-btn:hover:not([disabled]){ filter:brightness(.98); }
.step-btn:active:not([disabled]){ transform:translateY(1px); }
.step-input{ height:36px; line-height:36px; text-align:center; max-width:120px; }
.stepper .step-input:focus{ box-shadow:none; border-color:var(--brand-hover); }

/* Assist */
.assist{ font-size:12px; line-height:1.35; }
.assist .calc{ color:#6b7280; }
.assist .warn{ color:#b00020; }
.assist .hint{ color:#b45309; }

/* ========================
   Prepare button
======================== */
.prepare-btn{
  margin:16px 12px 16px;
  width:calc(100% - 24px); height:48px;
  border:none; border-radius:999px;
  background:#e5e5e7; color:#a0a0a4; cursor:not-allowed;
  font-weight:800;
}
.prepare-btn.is-primary:not([disabled]){
  background: var(--brand-primary); color:#fff; cursor:pointer;
  box-shadow:0 4px 14px rgba(11,94,207,.28);
}
.prepare-btn.is-primary:not([disabled]):hover,
.prepare-btn.is-primary:not([disabled]):focus-visible{ background: var(--brand-hover); outline:none; filter:none; }
.prepare-btn.is-primary:not([disabled]):active{ background: var(--brand-deep); transform:translateY(1px); }

/* ===== Preview modal (overlay) ===== */
.pv-scrim{
  position:fixed; inset:0; background:rgba(0,0,0,.72);
  z-index: 3000; display:grid; place-items:center; padding:24px;
}
.pv-card{
  background:#fff; width:min(980px, 96vw); border-radius:16px;
  box-shadow:0 18px 60px rgba(0,0,0,.45);
  padding:20px; position:relative;
}

/* close */
.pv-close{
  position:absolute; top:12px; right:12px;
  width:28px; height:28px; border-radius:50%;
  border:1px solid var(--ui-border); background:var(--ui-bg); cursor:pointer;
  font-size:18px; line-height:1;
}

/* header */
.pv-head{ display:flex; align-items:center; gap:14px; margin:4px 2px 14px; }
.pv-title{ font-weight:800; font-size:20px; }
.pv-head-sep{ width:1px; height:18px; background:var(--ui-border); }
.pv-file{ color:#6b7280; font-weight:700; }

/* layout */
.pv-body{ display:grid; grid-template-columns: 560px 1fr; gap:24px; }
.pv-canvas{
  background:#111; border-radius:12px; overflow:hidden; min-height:360px;
  display:grid; place-items:center; box-shadow:0 8px 28px rgba(0,0,0,.25) inset;
}
.pv-canvas img{ width:100%; height:100%; object-fit:cover; display:block; }

.pv-side{ display:flex; flex-direction:column; gap:18px; }

/* blocks */
.pv-block-title{ font-weight:800; margin-bottom:10px; font-size:18px; }
.pv-with-rule{ padding-bottom:8px; border-bottom:1px solid var(--ui-border); }

/* key-value list */
.pv-dl{
  display:grid; grid-template-columns: auto 1fr;
  gap:8px 14px; font-size:14px;
}
.pv-dl dt{ color:var(--brand-primary); }
.pv-dl dd{ margin:0; font-weight:700; text-align:right; }

/* CTA */
.pv-cta{
  margin-top:18px; width:100%; height:50px; border:none; border-radius:12px;
  background:var(--brand-primary); color:#fff; font-weight:800; cursor:pointer;
}
.pv-cta:hover{ background:var(--brand-hover); }
.pv-cta:active{ background:var(--brand-deep); }

/* responsive */
@media (max-width: 980px){
  .pv-body{ grid-template-columns: 1fr; }
  .pv-canvas{ min-height:300px; }
}

/* ========================
   Name suggestions (for File Name field)
======================== */
.namebox{ position:relative; }
.namebox.has-error .input{
  border-color:#e11d48;
  box-shadow:0 0 0 3px rgba(225,29,72,.1);
}

.namebox-spinner{
  position:absolute; right:10px; top:50%; width:16px; height:16px;
  margin-top:-8px; border:2px solid #cbd5e1; border-top-color:#0b5ecf;
  border-radius:50%; animation:nb_spin 1s linear infinite;
}
@keyframes nb_spin{ to{ transform:rotate(360deg); } }

.namebox-hints{
  position:absolute; z-index:10; left:0; right:0; top:calc(100% + 4px);
  background:#fff; border:1px solid var(--ui-border); border-radius:10px; padding:6px 0;
  box-shadow:0 10px 24px rgba(0,0,0,.12);
  max-height:220px; overflow:auto;
}
.namebox-hints li{ padding:8px 12px; cursor:pointer; font-size:14px; line-height:1.2; }
.namebox-hints li:hover{ background:#f3f4f6; }

/* --- kill inner white tile in uploaded card (keep grey frame) --- */
.upload-row *, .upload-row *::before, .upload-row *::after{
  background: transparent !important;
  background-image: none !important;
  box-shadow: none !important;
  border: 0 !important;
}
.upload-row [style*="background"]{
  background: transparent !important;
  background-image: none !important;
}
.upload-row :is(.bg-white, .card, .card-body, .Paper, .Paper-root, .MuiPaper-root,
                .ant-card, .ant-card-body, .chakra-card, .mantine-Paper-root,
                .tile, .panel, .panel-body, .wrapper, .content, .inner){
  background: transparent !important;
  box-shadow: none !important;
  border: 0 !important;
}
.upload-row .row-file, .upload-row .row-file > *{ background: transparent !important; }
.upload-row{
  background: var(--ui-bg) !important;
  border: 1px solid var(--ui-border) !important;
  border-radius: 12px !important;
  background-clip: padding-box;
}

/* ========================
   Preparing overlay (ตอนกด Prepare)
======================== */
.prep-scrim{
  position:fixed; inset:0;
  background:rgba(0,0,0,.72);
  z-index:3000;
  display:grid; place-items:center;
  padding:24px;
  animation:prepFade .18s ease-out;
}
@keyframes prepFade{ from{ opacity:0 } to{ opacity:1 } }

.prep-card{
  --radius: 24px;
  --pad-x: 28px;
  --pad-y: 22px;
  background:#fff;
  color:#111;
  border-radius:var(--radius);
  width:min(560px, 92vw);
  box-shadow:
    0 20px 60px rgba(0,0,0,.45),
    0 2px 0 rgba(17,17,17,.02) inset;
  padding:var(--pad-y) var(--pad-x);
  text-align:center;
  transform:translateY(2px);
}
.prep-card.-busy{
  display:grid;
  grid-template-rows:auto auto auto auto;
  row-gap:12px;
}

/* Spinner */
.prep-icon{ display:flex; justify-content:center; margin-bottom:4px; }
.prep-spinner{ width:44px; height:44px; }
.prep-spinner .track{
  stroke:#e5e7eb; stroke-width:4; fill:none;
}
.prep-spinner .indicator{
  stroke:var(--brand-primary); stroke-width:4; fill:none;
  stroke-linecap:round;
  stroke-dasharray:80 60;
  transform-origin:50% 50%;
  animation:prepSpin 1.1s linear infinite, prepDash 1.1s ease-in-out infinite;
}
@keyframes prepSpin{ to{ transform:rotate(360deg);} }
@keyframes prepDash{
  0%   { stroke-dasharray: 10 130; stroke-dashoffset: 0; }
  50%  { stroke-dasharray: 90 50;  stroke-dashoffset: -20; }
  100% { stroke-dasharray: 10 130; stroke-dashoffset: -140; }
}

/* Title & Sub */
.prep-title{ font-weight:800; font-size:20px; letter-spacing:.2px; }
.prep-sub{ font-size:14px; color:#6b7280; margin-top:-2px; }

/* Indeterminate bar */
.prep-bar{
  position:relative;
  height:10px;
  background:#eef0f3;
  border-radius:999px;
  overflow:hidden;
  margin-top:6px;
}
.prep-bar-fill{
  position:absolute; top:0; left:-40%;
  height:100%; width:40%;
  background:linear-gradient(90deg, #a9c9ff, var(--brand-primary));
  border-radius:999px;
  filter:saturate(1.1);
  animation:prepSlide 1.6s ease-in-out infinite;
  box-shadow:0 0 18px rgba(11,94,207,.35);
}
@keyframes prepSlide{
  0%   { left:-35%; width:35%; }
  50%  { left:20%;  width:65%; }
  100% { left:100%; width:35%; }
}

/* Compact on small screens */
@media (max-width: 420px){
  .prep-card{ --radius:20px; --pad-x:18px; --pad-y:18px; width:min(94vw, 480px); }
  .prep-spinner{ width:38px; height:38px; }
  .prep-title{ font-size:18px; }
  .prep-sub{ font-size:13px; }
}
